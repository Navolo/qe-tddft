# QE and TDDFT Installation instructions for Centurion
This file explains how to install Quantum Espresso, ce-tddft, and reed-tddft on centurion.

#### 1 Clone this github repo
```
$ git clone https://github.com/rehnd/qe-tddft.git
```
*Note*: this will likely fail due to outdated SSL certificates on centurion. We are currently working on fixing this issue. For options for getting around this, talk to Danny.

#### 2 Edit your .bashrc file to use the intel compiler and Open MPI
Add the following lines to ~/.bashrc

```
source /opt/intel/fce/11/bin/ifortvars.sh intel64
source /opt/open-mpi/tcp-intel11/mpivars.sh
source /opt/intel/mkl/10.1/tools/environment/mklvarsem64t.sh
```

#### 3 Source your .bashrc file
```
$ source ~/.bashrc
```

#### 4 Enter the qe-tddft folder and configure
```
$ cd qe-tddft
$ ./configure --prefix='/home/username/path/to/qe-tddft'
```
(Make sure you edit the path when running configure)

#### 5 Edit make.sys
Change line 67 in make.sys. Note that make.sys is generated by configure, and for now this is a hack to change the fortran compiler after this has been generated. *In the future, this should not be necessary.*

```
F77 = ifort
```

#### 6 Install epsresso pw code
In the top-level directory of this repo, run

```
$ make pw
```
Alternatively, it is fine to run

```
$ make all
```
which will build all of the original Quantum Espresso packages in qe-tddft (not just the pw package).


#### 7 Install ce-tddft (the original one with no modifications)
The ce-tddft folder should be kept as the original ce-tddft code found at [https://github.com/dceresoli/ce-tddft], with as few modifications as possible. The only modifications that we have made are in configure.ac, which allows this version of ce-tddft to compile with version 5.2.* of Quantum Espresso.

```
$ cd ce-tddft
$ autoconf
$ ./configure --with-qe-source=..
$ mkdir bin
$ make all
```

The executable tddft.x is in the folder ```qe-tddft/ce-tddft/bin```.

#### 8 Configure the runscript on the PBS on centurion
Change to the bin directory in the top-level espresso directory
```
$ cd qe-tddft/bin/
```

Open the file titled ```run_espresso``` and edit line 43 to say

```
echo "mpirun -bynode -np $nproc $your_dir/qe-tddft/bin/pw.x  < $input >& `pwd`/$output" >> $script
```
where ```$your_dir``` is the directory that contains the top-level qe-tddft directory.

Now change to the ce-tddft bin directory

```
$ cd ce-tddft/bin/
```

Open the ```run_cetddft``` shell script and change line 43 to

```
echo "mpirun -bynode -np $nproc $your_dir/qe-tddft/ce-tddft/bin/tddft.x  < $input >& `pwd`/$output" >> $script
```
That concludes the installation.

## Running Examples
The following describes how to run examples to ensure that the installation worked properly

#### 1 Graphene
The graphene example uses an E-field in the z-direction, includes spin-degeneracy, and uses a (16 x 16 x 1) k-point mesh with a 25 Ry cutoff energy.

```
$ cd ce-tddft/examples/graphene
```

Please read the run_espresso file carefully to make sure you understand how to run jobs on the PBS.

To run the example, execute the following


```
$ ../../../bin/run_espresso 1 16 graphene.pw-in graphene.pw-out
```

For now, the ce-tddft code is still serial but you can nevertheless run the following command when the PW is finished. Please use a reasonable number of time steps for time propagation.


```
$ ../../bin/run_cetddft 1 16 graphene.tddft-in graphene.tddft-out
$ grep ^DIP graphene.tddft-out > dip_z.dat
$ python ../../tools/plot_optical_absorption.py z
```

Compare your results with the ones in ```examples/graphene/compare_results```
